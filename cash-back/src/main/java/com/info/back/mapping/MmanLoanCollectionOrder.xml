<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--      
	This file is automatically generated by autoCode(https://git.oschina.net/durcframework/autoCode)
-->
<mapper namespace="com.info.back.dao.IMmanLoanCollectionOrderDao">
    <resultMap id="queryResultMap" type="com.info.web.pojo.MmanLoanCollectionOrder">
        <result column="id" property="id" jdbcType="VARCHAR"/>
        <!-- 催收订单id -->
        <result column="order_id" property="orderId" jdbcType="VARCHAR"/>
        <!-- 借款用户ID -->
        <result column="user_id" property="userId" jdbcType="VARCHAR"/>
        <!-- 借款ID -->
        <result column="loan_id" property="loanId" jdbcType="VARCHAR"/>
        <!-- 还款ID -->
        <result column="pay_id" property="payId" jdbcType="VARCHAR"/>
        <!-- 派单人 -->
        <result column="dispatch_name" property="dispatchName" jdbcType="VARCHAR"/>
        <!-- 派单时间 -->
        <result column="dispatch_time" property="dispatchTime" jdbcType="TIMESTAMP"/>
        <!-- 上一催收员ID -->
        <result column="last_collection_user_id" property="lastCollectionUserId" jdbcType="VARCHAR"/>
        <!-- 当前催收员ID -->
        <result column="current_collection_user_id" property="currentCollectionUserId" jdbcType="VARCHAR"/>
        <!-- 当前逾期等级（即逾期字典分组） -->
        <result column="current_overdue_level" property="currentOverdueLevel" jdbcType="VARCHAR"/>
        <!-- 逾期天数 -->
        <result column="overdueDays" property="overdueDays" jdbcType="INTEGER"/>
        <!-- s1审批人ID -->
        <result column="m1_approve_id" property="m1ApproveId" jdbcType="VARCHAR"/>
        <!-- s1审批人操作状态（1，已操作过，0或null未操作过） -->
        <result column="m1OperateStatus" property="m1OperateStatus" jdbcType="VARCHAR"/>
        <!-- s2审批人ID -->
        <result column="m2_approve_id" property="m2ApproveId" jdbcType="VARCHAR"/>
        <!-- s2审批人操作状态（1，已操作过，0或null未操作过） -->
        <result column="m2OperateStatus" property="m2OperateStatus" jdbcType="VARCHAR"/>
        <!-- m1-m2审批人ID -->
        <result column="m3_approve_id" property="m3ApproveId" jdbcType="VARCHAR"/>
        <!-- m1-m2审批人操作状态（1，已操作过，0或null未操作过） -->
        <result column="m3OperateStatus" property="m3OperateStatus" jdbcType="VARCHAR"/>
        <!-- m2-m3审批人ID -->
        <result column="m4_approve_id" property="m4ApproveId" jdbcType="VARCHAR"/>
        <!-- m2-m3审批人操作状态（1，已操作过，0或null未操作过） -->
        <result column="m4OperateStatus" property="m4OperateStatus" jdbcType="VARCHAR"/>
        <!-- m3+审批人ID -->
        <result column="m5_approve_id" property="m5ApproveId" jdbcType="VARCHAR"/>
        <!-- m3+审批人操作状态（1，已操作过，0或null未操作过） -->
        <result column="m5OperateStatus" property="m5OperateStatus" jdbcType="VARCHAR"/>
        <!-- m6审批人ID -->
        <result column="m6_approve_id" property="m6ApproveId" jdbcType="VARCHAR"/>
        <!-- 催收状态 -->
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <!-- 承诺还款时间 -->
        <result column="promise_repayment_time" property="promiseRepaymentTime" jdbcType="TIMESTAMP"/>
        <!-- 最后催收时间 -->
        <result column="last_collection_time" property="lastCollectionTime" jdbcType="TIMESTAMP"/>
        <!-- 创建时间 -->
        <result column="create_date" property="createDate" jdbcType="TIMESTAMP"/>
        <!-- 更新时间 -->
        <result column="update_date" property="updateDate" jdbcType="TIMESTAMP"/>
        <!-- 操作人 -->
        <result column="operator_name" property="operatorName" jdbcType="VARCHAR"/>
        <!-- 备注 -->
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <!-- 委外催收人id -->
        <result column="outside_person_id" property="outsidePersonId" jdbcType="VARCHAR"/>
        <!-- 委外前催收状态 -->
        <result column="before_status" property="beforeStatus" jdbcType="VARCHAR"/>
        <!-- 委外机构ID -->
        <result column="outside_company_id" property="outsideCompanyId" jdbcType="VARCHAR"/>
        <!-- 聚立信息报告审核 0 初始 1 申请 2同意 ，3拒绝 -->
        <result column="jxl_status" property="jxlStatus" jdbcType="VARCHAR"/>
        <!-- 是否进行续借出催 1启用 0不启用 -->
        <result column="renew_status" property="renewStatus" jdbcType="VARCHAR"/>
        <!-- 聚信立 报告申请时间 -->
        <result column="jxl_apply_Time" property="jxlApplyTime" jdbcType="TIMESTAMP"/>
        <!-- 聚信立报告审核时间 -->
        <result column="jx_audit_ime" property="jxAuditIme" jdbcType="TIMESTAMP"/>
        <!-- 催收建议状态 1申请 2 同意 3拒绝 -->
        <result column="csstatus" property="csstatus" jdbcType="VARCHAR"/>
        <result column="s1_flag" property="s1Flag" jdbcType="VARCHAR"/>
        <!-- 借款人姓名 -->
        <result column="loan_user_name" property="loanUserName" jdbcType="VARCHAR"/>
        <!-- 借款人电话 -->
        <result column="loan_user_phone" property="loanUserPhone" jdbcType="VARCHAR"/>
        <!-- 借款人身份证 -->
        <result column="id_number" property="idNumber" jdbcType="VARCHAR"/>
        <!-- 减免滞纳金金额-->
        <result column="reduction_money" jdbcType="DECIMAL" property="reductionMoney"/>
        <!--标记订单是否是2号派单-->
        <result column="second_day_flag" property="secondDayFlag" jdbcType="VARCHAR"/>
        <result column="real_money" property="realMoney" />
    </resultMap>

    <!--<select id="getCollectionMyOrderList" resultType="com.info.web.pojo.OrderBaseResult" parameterType="HashMap" >
            SELECT
              a.`id`,
              a.`order_id` AS orderId,
              a.`loan_id` loanId,
              d.`loan_money` AS loanMoney,
              a.`overdueDays` AS overdueDays,
              d.`loan_penalty` AS loanPenlty,
              a.`status` AS collectionStatus,
              d.`loan_end_time` AS loanEndTime,
              a.`last_collection_time` AS lastCollectionTime,
              a.`promise_repayment_time` AS promiseRepaymentTime,
              a.`dispatch_time` AS dispatchTime,
              a.`top_important` AS topImportant,
              a.dispatch_name AS dispatchName,
              a.loan_user_name as realName,
              a.loan_user_phone as phoneNumber,
              a.real_money as returnMoney,
              a.`top_important` as topImportant,
              a.id_number as idNumber,
              a.current_overdue_level collectionGroup,
              a.reduction_money as reductionMoney
              FROM mman_loan_collection_order a
              LEFT JOIN mman_user_loan d ON a.loan_id = d.id
              <include refid="my_base_where"></include>
    </select>
    <select id="getCollectionMyOrderCount" resultType="Integer" parameterType="HashMap" >
        SELECT count(1) FROM mman_loan_collection_order a LEFT JOIN mman_user_loan d ON a.loan_id = d.id
        <include refid="my_base_where"></include>
    </select>
    <sql id="my_base_where">
            <where>
                1=1
                <if test="roleUserId!=null and roleUserId !=''">
                    AND a.current_collection_user_id=#{roleUserId}
                </if>
                <if test="CompanyPermissionsList != null and CompanyPermissionsList.size>0 " >
                    AND a.`outside_company_id` in
                        <foreach collection="CompanyPermissionsList" close=")" item="items" open="(" separator=",">
                            #{items.companyId}
                        </foreach>
                </if>
                <if test="collectionBeginTime!=null">
                    <![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') >=  #{collectionBeginTime}  ]]>
                </if>
                <if test="collectionEndTime !=null">
                    <![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') <=  #{collectionEndTime}  ]]>
                </if>
                <if test="dispatchBeginTime !=null">
                    <![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d') >= #{dispatchBeginTime}  ]]>
                </if>
                <if test="dispatchEndTime !=null">
                    <![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d')<=#{dispatchEndTime}  ]]>
                </if>
                <if test="overDueDaysBegin !=null and overDueDaysBegin!=''">
                    <![CDATA[ AND a.overdueDays>=#{overDueDaysBegin}  ]]>
                </if>
                <if test="overDueDaysEnd !=null and overDueDaysEnd !=''">
                    <![CDATA[ AND a.overdueDays<=#{overDueDaysEnd}  ]]>
                </if>
                <if test="loanRealName !=null and loanRealName!=''">
                    AND a.loan_user_name=#{loanRealName}
                </if>
                <if test="loanUserPhone !=null and loanUserPhone!= ''">
                    AND a.loan_user_phone=#{loanUserPhone}
                </if>
                <if test="loanId !=null and loanId!=''">
                    AND a.`loan_id`=#{loanId}
                </if>
                <if test="companyId !=null and companyId!='' ">
                    AND a.outside_company_id=#{companyId}
                </if>
                <if test="status !=null and status!=''">
                    AND a.status=#{status}
                </if>
                <if test="topImportant!=null and topImportant!=''">
                    AND a.top_important=#{topImportant}
                </if>
                <if test="collectionGroup !=null and collectionGroup !=''">
                    AND a.current_overdue_level=#{collectionGroup}
                </if>
            </where>
            <if test="sortBy !=null and sortBy!=''">
                ORDER BY a.${sortBy}
            </if>
            <if test="sortBy =null or sortBy==''">
                ORDER BY a.top_important DESC, a.dispatch_time DESC
            </if>
    </sql>-->

    <select id="getCollectionOrderList" resultType="com.info.web.pojo.OrderBaseResult" parameterType="HashMap">
        SELECT
        <include refid="base_select"></include>
        <include refid="base_table"></include>
        <include refid="base_where"></include>
    </select>
    <select id="getCollectionOrderCount" resultType="Integer" parameterType="HashMap">
		SELECT 
			count(*)
			FROM mman_loan_collection_order a
	</select>

    <select id="getOrderCount" resultType="Integer" parameterType="HashMap">
        SELECT
        count(*)
        FROM mman_loan_collection_order a
        <!-- WHERE  a.current_collection_user_id=#{roleUserId} -->
    </select>
    <sql id="base_table">
		FROM mman_loan_collection_order a
        LEFT JOIN back_user b ON a.`current_collection_user_id` = b.uuid
        LEFT JOIN credit_loan_pay c ON a.pay_id = c.id
        LEFT JOIN mman_user_loan d ON a.loan_id = d.id
        LEFT JOIN mman_loan_collection_company e ON b.`company_id`= e.id
        LEFT JOIN back_user bu on bu.uuid = a.last_collection_user_id
	</sql>
    <sql id="base_where">
        <where>

            a.`status` != '-1'

            <if test="roleUserId!=null and roleUserId !=''">
                AND a.current_collection_user_id = #{roleUserId}
            </if>

            <if test="CompanyPermissionsList != null and CompanyPermissionsList.size>0 ">
                AND b.`company_id` in
                <foreach collection="CompanyPermissionsList" close=")" item="items" open="(" separator=",">
                    #{items.companyId}
                </foreach>
            </if>
            <if test="collectionBeginTime!=null">
                <![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') >=  #{collectionBeginTime}  ]]>
            </if>
            <if test="collectionEndTime !=null">
                <![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') <=  #{collectionEndTime}  ]]>
            </if>
            <if test="dispatchBeginTime !=null">
                AND dispatch_time &gt;= #{dispatchBeginTime}
            </if>
            <if test="dispatchEndTime !=null">
                AND dispatch_time &lt;= DATE_ADD(#{dispatchEndTime}, INTERVAL 1 DAY)
            </if>
            <if test="overDueDaysBegin !=null and overDueDaysBegin!=''">
                <![CDATA[ AND a.overdueDays >= #{overDueDaysBegin}  ]]>
            </if>
            <if test="overDueDaysEnd !=null and overDueDaysEnd !=''">
                <![CDATA[ AND a.overdueDays <= #{overDueDaysEnd}  ]]>
            </if>
            <if test="loanRealName !=null and loanRealName!=''">
                AND a.loan_user_name = #{loanRealName}
            </if>
            <if test="loanUserPhone !=null and loanUserPhone!= ''">
                AND a.loan_user_phone = #{loanUserPhone}
            </if>
            <if test="collectionPhone !=null and collectionPhone!=''">
                AND b.user_mobile = #{collectionPhone}
            </if>
            <if test="collectionRealName !=null and collectionRealName!=''">
                AND b.user_name = #{collectionRealName}
            </if>
            <if test="loanId !=null and loanId!=''">
                AND a.`loan_id` = #{loanId}
            </if>
            <if test="collectionGroup !=null and collectionGroup !=''">
                AND b.group_level = #{collectionGroup}
            </if>
            <if test="companyId !=null and companyId!='' ">
                AND b.company_id = #{companyId}
            </if>
            <if test="status !=null and status!=''">
                AND a.status = #{status}
            </if>
            <if test="topImportant!=null and topImportant!=''">
                AND a.top_important = #{topImportant}
            </if>
            <if test="customerType != null and customerType != ''">
                AND d.customer_type = #{customerType}
            </if>
        </where>
        <if test="sortBy !=null and sortBy!=''">
            ORDER BY a.${sortBy}
        </if>
        <if test="sortBy =null or sortBy==''">
            ORDER BY a.top_important DESC, a.dispatch_time DESC, c.update_Date DESC
        </if>
    </sql>

    <!--<sql id="base_where_count">
        <where>
             a.current_collection_user_id=#{roleUserId}
            <if test="CompanyPermissionsList != null and CompanyPermissionsList.size>0 " >
                AND b.`company_id` in
                <foreach collection="CompanyPermissionsList" close=")" item="items" open="(" separator=",">
                    #{items.companyId}
                </foreach>
            </if>
            <if test="collectionBeginTime!=null">
                <![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') >=  #{collectionBeginTime}  ]]>
            </if>
            <if test="collectionEndTime !=null">
                <![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') <=  #{collectionEndTime}  ]]>
            </if>
            <if test="dispatchBeginTime !=null">
                <![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d') >= #{dispatchBeginTime}  ]]>
            </if>
            <if test="dispatchEndTime !=null">
                <![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d')<=#{dispatchEndTime}  ]]>
            </if>
            <if test="overDueDaysBegin !=null and overDueDaysBegin!=''">
                <![CDATA[ AND a.overdueDays>=#{overDueDaysBegin}  ]]>
            </if>
            <if test="overDueDaysEnd !=null and overDueDaysEnd !=''">
                <![CDATA[ AND a.overdueDays<=#{overDueDaysEnd}  ]]>
            </if>
            <if test="loanRealName !=null and loanRealName!=''">
                AND a.loan_user_name=#{loanRealName}
            </if>
            <if test="loanUserPhone !=null and loanUserPhone!= ''">
                AND a.loan_user_phone=#{loanUserPhone}
            </if>
            <if test="collectionPhone !=null and collectionPhone!=''">
                AND b.user_mobile=#{collectionPhone}
            </if>
            <if test="collectionRealName !=null and collectionRealName!=''">
                AND b.user_name=#{collectionRealName}
            </if>
            <if test="loanId !=null and loanId!=''">
                AND a.`loan_id`=#{loanId}
            </if>
            <if test="collectionGroup !=null and collectionGroup !=''">
                AND b.group_level=#{collectionGroup}
            </if>
            <if test="companyId !=null and companyId!='' ">
                AND b.company_id=#{companyId}
            </if>
            <if test="status !=null and status!=''">
                AND a.status=#{status}
            </if>
            <if test="topImportant!=null and topImportant!=''">
                AND a.top_important=#{topImportant}
            </if>
        </where>
        <if test="sortBy !=null and sortBy!=''">
            ORDER BY a.${sortBy}
        </if>
        <if test="sortBy =null or sortBy==''">
            ORDER BY a.top_important DESC, a.dispatch_time DESC, c.update_Date DESC
        </if>
    </sql>-->

    <sql id="base_select">
		    a.`id`,
			a.`order_id` as orderId,
			a.`loan_id` loanId,
			d.paid_money AS paidMoney,
			d.service_charge AS serviceCharge,
			e.`title`  as companyTile,
			b.`group_level` as collectionGroup,
			a.loan_user_name as realName,
			a.loan_user_phone as  phoneNumber,
			a.id_number AS idCard,
			a.real_money as returnMoney,
			d.`loan_money` as loanMoney,
			a.`overdueDays` as overdueDays,
			d.`loan_penalty` as loanPenlty,
			a.`status` as collectionStatus,
			c.`real_money` as returnMoney,
			c.`update_Date` as currentReturnDay,
			d.`loan_end_time` as loanEndTime,
			d.accrual AS accrual,
			a.`last_collection_time` as lastCollectionTime,
			bu.user_name as lastUserName,
			a.`promise_repayment_time` as promiseRepaymentTime,
			a.`dispatch_time` as dispatchTime,
			a.`top_important` as topImportant,
			a.dispatch_name as dispatchName,
			b.`user_name` as currUserName,
			a.reduction_money as reductionMoney,
			a.second_day_flag,
			a.dispatch_name AS dispatchName,
			d.customer_type AS customerType
	</sql>
    <!-- 保存,保存不为NULL的字段 -->
    <insert id="saveNotNull" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">INSERT INTO mman_loan_collection_order
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">`id`,</if>
            <if test="orderId != null">`order_id`,</if>
            <if test="userId != null">`user_id`,</if>
            <if test="loanId != null">`loan_id`,</if>
            <if test="payId != null">`pay_id`,</if>
            <if test="dispatchName != null">`dispatch_name`,</if>
            <if test="dispatchTime != null">`dispatch_time`,</if>
            <if test="lastCollectionUserId != null">`last_collection_user_id`,</if>
            <if test="currentCollectionUserId != null">`current_collection_user_id`,</if>
            <if test="currentOverdueLevel != null">`current_overdue_level`,</if>
            <if test="overdueDays != null">`overdueDays`,</if>
            <if test="m1ApproveId != null">`m1_approve_id`,</if>
            <if test="m1OperateStatus != null">`m1OperateStatus`,</if>
            <if test="m2ApproveId != null">`m2_approve_id`,</if>
            <if test="m2OperateStatus != null">`m2OperateStatus`,</if>
            <if test="m3ApproveId != null">`m3_approve_id`,</if>
            <if test="m3OperateStatus != null">`m3OperateStatus`,</if>
            <if test="m4ApproveId != null">`m4_approve_id`,</if>
            <if test="m4OperateStatus != null">`m4OperateStatus`,</if>
            <if test="m5ApproveId != null">`m5_approve_id`,</if>
            <if test="m5OperateStatus != null">`m5OperateStatus`,</if>
            <if test="m6ApproveId != null">`m6_approve_id`,</if>
            <if test="status != null">`status`,</if>
            <if test="promiseRepaymentTime != null">`promise_repayment_time`,</if>
            <if test="lastCollectionTime != null">`last_collection_time`,</if>
            <if test="createDate != null">`create_date`,</if>
            <if test="updateDate != null">`update_date`,</if>
            <if test="operatorName != null">`operator_name`,</if>
            <if test="remark != null">`remark`,</if>
            <if test="outsidePersonId != null">`outside_person_id`,</if>
            <if test="beforeStatus != null">`before_status`,</if>
            <if test="outsideCompanyId != null">`outside_company_id`,</if>
            <if test="jxlStatus != null">`jxl_status`,</if>
            <if test="renewStatus != null">`renew_status`,</if>
            <if test="jxlApplyTime != null">`jxl_apply_Time`,</if>
            <if test="jxAuditIme != null">`jx_audit_ime`,</if>
            <if test="csstatus != null">`csstatus`,</if>
            <if test="reductionMoney != null">`reduction_money`,</if>
            <if test="idNumber != null">`id_number`,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id,jdbcType=VARCHAR},</if>
            <if test="orderId != null">#{orderId,jdbcType=VARCHAR},</if>
            <if test="userId != null">#{userId,jdbcType=VARCHAR},</if>
            <if test="loanId != null">#{loanId,jdbcType=VARCHAR},</if>
            <if test="payId != null">#{payId,jdbcType=VARCHAR},</if>
            <if test="dispatchName != null">#{dispatchName,jdbcType=VARCHAR},</if>
            <if test="dispatchTime != null">#{dispatchTime,jdbcType=TIMESTAMP},</if>
            <if test="lastCollectionUserId != null">#{lastCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentCollectionUserId != null">#{currentCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentOverdueLevel != null">#{currentOverdueLevel,jdbcType=VARCHAR},</if>
            <if test="overdueDays != null">#{overdueDays,jdbcType=INTEGER},</if>
            <if test="m1ApproveId != null">#{m1ApproveId,jdbcType=VARCHAR},</if>
            <if test="m1OperateStatus != null">#{m1OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m2ApproveId != null">#{m2ApproveId,jdbcType=VARCHAR},</if>
            <if test="m2OperateStatus != null">#{m2OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m3ApproveId != null">#{m3ApproveId,jdbcType=VARCHAR},</if>
            <if test="m3OperateStatus != null">#{m3OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m4ApproveId != null">#{m4ApproveId,jdbcType=VARCHAR},</if>
            <if test="m4OperateStatus != null">#{m4OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m5ApproveId != null">#{m5ApproveId,jdbcType=VARCHAR},</if>
            <if test="m5OperateStatus != null">#{m5OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m6ApproveId != null">#{m6ApproveId,jdbcType=VARCHAR},</if>
            <if test="status != null">#{status,jdbcType=VARCHAR},</if>
            <if test="promiseRepaymentTime != null">#{promiseRepaymentTime,jdbcType=TIMESTAMP},</if>
            <if test="lastCollectionTime != null">#{lastCollectionTime,jdbcType=TIMESTAMP},</if>
            <if test="createDate != null">#{createDate,jdbcType=TIMESTAMP},</if>
            <if test="updateDate != null">#{updateDate,jdbcType=TIMESTAMP},</if>
            <if test="operatorName != null">#{operatorName,jdbcType=VARCHAR},</if>
            <if test="remark != null">#{remark,jdbcType=VARCHAR},</if>
            <if test="outsidePersonId != null">#{outsidePersonId,jdbcType=VARCHAR},</if>
            <if test="beforeStatus != null">#{beforeStatus,jdbcType=VARCHAR},</if>
            <if test="outsideCompanyId != null">#{outsideCompanyId,jdbcType=VARCHAR},</if>
            <if test="jxlStatus != null">#{jxlStatus,jdbcType=VARCHAR},</if>
            <if test="renewStatus != null">#{renewStatus,jdbcType=VARCHAR},</if>
            <if test="jxlApplyTime != null">#{jxlApplyTime,jdbcType=TIMESTAMP},</if>
            <if test="jxAuditIme != null">#{jxAuditIme,jdbcType=TIMESTAMP},</if>
            <if test="csstatus != null">#{csstatus,jdbcType=VARCHAR},</if>
            <if test="reductionMoney != null">#{reductionMoney,jdbcType=DECIMAL},</if>
            <if test="idNumber != null">#{idNumber,jdbcType=DECIMAL},</if>
        </trim>
    </insert>
    <!-- 更新不为NULL的字段 -->
    <update id="updateNotNull" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">UPDATE mman_loan_collection_order
        <set>
            <if test="orderId != null">order_id=#{orderId,jdbcType=VARCHAR},</if>
            <if test="userId != null">user_id=#{userId,jdbcType=VARCHAR},</if>
            <if test="loanId != null">loan_id=#{loanId,jdbcType=VARCHAR},</if>
            <if test="payId != null">pay_id=#{payId,jdbcType=VARCHAR},</if>
            <if test="dispatchName != null">dispatch_name=#{dispatchName,jdbcType=VARCHAR},</if>
            <if test="dispatchTime != null">dispatch_time=#{dispatchTime,jdbcType=TIMESTAMP},</if>
            <if test="lastCollectionUserId != null">last_collection_user_id=#{lastCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentCollectionUserId != null">current_collection_user_id=#{currentCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentOverdueLevel != null">current_overdue_level=#{currentOverdueLevel,jdbcType=VARCHAR},</if>
            <if test="overdueDays != null">overdueDays=#{overdueDays,jdbcType=INTEGER},</if>
            <if test="m1ApproveId != null">m1_approve_id=#{m1ApproveId,jdbcType=VARCHAR},</if>
            <if test="m1OperateStatus != null">m1OperateStatus=#{m1OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m2ApproveId != null">m2_approve_id=#{m2ApproveId,jdbcType=VARCHAR},</if>
            <if test="m2OperateStatus != null">m2OperateStatus=#{m2OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m3ApproveId != null">m3_approve_id=#{m3ApproveId,jdbcType=VARCHAR},</if>
            <if test="m3OperateStatus != null">m3OperateStatus=#{m3OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m4ApproveId != null">m4_approve_id=#{m4ApproveId,jdbcType=VARCHAR},</if>
            <if test="m4OperateStatus != null">m4OperateStatus=#{m4OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m5ApproveId != null">m5_approve_id=#{m5ApproveId,jdbcType=VARCHAR},</if>
            <if test="m5OperateStatus != null">m5OperateStatus=#{m5OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m6ApproveId != null">m6_approve_id=#{m6ApproveId,jdbcType=VARCHAR},</if>
            <if test="status != null">status=#{status,jdbcType=VARCHAR},</if>
            <if test="promiseRepaymentTime != null">promise_repayment_time=#{promiseRepaymentTime,jdbcType=TIMESTAMP},</if>
            <if test="lastCollectionTime != null">last_collection_time=#{lastCollectionTime,jdbcType=TIMESTAMP},</if>
            <if test="createDate != null">create_date=#{createDate,jdbcType=TIMESTAMP},</if>
            <if test="updateDate != null">update_date=#{updateDate,jdbcType=TIMESTAMP},</if>
            <if test="operatorName != null">operator_name=#{operatorName,jdbcType=VARCHAR},</if>
            <if test="remark != null">remark=#{remark,jdbcType=VARCHAR},</if>
            <if test="outsidePersonId != null">outside_person_id=#{outsidePersonId,jdbcType=VARCHAR},</if>
            <if test="beforeStatus != null">before_status=#{beforeStatus,jdbcType=VARCHAR},</if>
            <if test="outsideCompanyId != null">outside_company_id=#{outsideCompanyId,jdbcType=VARCHAR},</if>
            <if test="jxlStatus != null">jxl_status=#{jxlStatus,jdbcType=VARCHAR},</if>
            <if test="renewStatus != null">renew_status=#{renewStatus,jdbcType=VARCHAR},</if>
            <if test="jxlApplyTime != null">jxl_apply_Time=#{jxlApplyTime,jdbcType=TIMESTAMP},</if>
            <if test="jxAuditIme != null">jx_audit_ime=#{jxAuditIme,jdbcType=TIMESTAMP},</if>
            <if test="csstatus != null">csstatus=#{csstatus,jdbcType=VARCHAR},</if>
            <if test="idNumber != null">csstatus=#{idNumber,jdbcType=VARCHAR},</if>
        </set>
        WHERE id = #{id,jdbcType=VARCHAR}
    </update>
    <!-- 根据id获取单条记录 -->
    <select id="getOrderById" resultMap="queryResultMap" parameterType="String">
	SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id ,
	t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id ,
	 t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date ,
	 t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime ,t.s1_flag ,
	 t.csstatus , t.loan_user_name , t.loan_user_phone,t.reduction_money,t.id_number,t.real_money,t.product_name FROM mman_loan_collection_order t WHERE t.id = #{id,jdbcType=VARCHAR}</select>
    <select id="getBaseOrderById" resultType="com.info.web.pojo.OrderBaseResult" parameterType="String">
		SELECT
			a.`id` AS  id,
			a.`loan_id` AS loanId,
			d.`loan_money` AS loanMoney,
			a.loan_user_name AS realName,
			a.`overdueDays` AS overdueDays,
			d.`loan_penalty` AS loanPenlty
			FROM mman_loan_collection_order a LEFT JOIN mman_user_loan d ON a.loan_id = d.id
			WHERE a.id=#{orderId}

	</select>

    <select id="getOrderByUserId" resultMap="queryResultMap" parameterType="String">
		SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime , t.csstatus , t.loan_user_name , t.loan_user_phone,t.reduction_money,t.id_number FROM mman_loan_collection_order t WHERE t.user_id = #{userId,jdbcType=VARCHAR}</select>
    <!-- 根据主键获取单条记录 -->
    <select id="get" resultMap="queryResultMap"
            parameterType="com.info.web.pojo.MmanLoanCollectionOrder">SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime , t.csstatus,t.id_number FROM mman_loan_collection_order t WHERE id = #{id,jdbcType=VARCHAR}</select>
    <!-- 根据主键删除记录 -->
    <delete id="del" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">DELETE FROM mman_loan_collection_order WHERE id = #{id,jdbcType=VARCHAR}</delete>

    <select id="findList" resultMap="queryResultMap" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">
        SELECT t.id ,
        t.order_id ,
        t.user_id ,
        t.loan_id ,
        t.pay_id ,
        t.dispatch_name ,
        t.dispatch_time ,
        t.last_collection_user_id ,
        t.current_collection_user_id ,
        t.current_overdue_level ,
        t.overdueDays ,
        t.m1_approve_id ,
        t.m1OperateStatus ,
        t.m2_approve_id ,
        t.m2OperateStatus ,
        t.m3_approve_id ,
        t.m3OperateStatus ,
        t.m4_approve_id ,
        t.m4OperateStatus ,
        t.m5_approve_id ,
        t.m5OperateStatus ,
        t.m6_approve_id ,
        t.status ,
        t.promise_repayment_time ,
        t.last_collection_time ,
        t.create_date ,
        t.update_date ,
        t.operator_name ,
        t.remark ,
        t.outside_person_id ,
        t.before_status ,
        t.outside_company_id ,
        t.jxl_status ,
        t.renew_status ,
        t.jxl_apply_Time ,
        t.jx_audit_ime ,
        t.s1_flag,
        t.csstatus ,
        t.reduction_money,
        t.id_number,
        t.second_day_flag
        FROM mman_loan_collection_order t
        <where>
            <if test="id !=null and id !=''">
                and id = #{id}
            </if>
            <if test="loanId !=null and loanId !=''">
                and loan_id = #{loanId}
            </if>
        </where>
    </select>


    <insert id="insertCollectionOrder" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">INSERT INTO mman_loan_collection_order
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null and id!=''">`id`,</if>
            <if test="orderId != null and orderId!=''">`order_id`,</if>
            <if test="userId != null and userId!=''">`user_id`,</if>
            <if test="loanId != null and loanId!=''">`loan_id`,</if>
            <if test="payId != null and payId!=''">`pay_id`,</if>
            <if test="dispatchName != null and dispatchName!=''">`dispatch_name`,</if>
            <if test="dispatchTime != null">`dispatch_time`,</if>
            <if test="lastCollectionUserId != null and lastCollectionUserId!=''">`last_collection_user_id`,</if>
            <if test="currentCollectionUserId != null and currentCollectionUserId!=''">`current_collection_user_id`,</if>
            <if test="currentOverdueLevel != null and currentOverdueLevel!=''">`current_overdue_level`,</if>
            <if test="overdueDays != null">`overdueDays`,</if>
            <if test="m1ApproveId != null and m1ApproveId!=''">`m1_approve_id`,</if>
            <if test="m1OperateStatus != null and m1OperateStatus!=''">`m1OperateStatus`,</if>
            <if test="m2ApproveId != null and m2ApproveId!=''">`m2_approve_id`,</if>
            <if test="m2OperateStatus != null and m2OperateStatus!=''">`m2OperateStatus`,</if>
            <if test="m3ApproveId != null and m3ApproveId!=''">`m3_approve_id`,</if>
            <if test="m3OperateStatus != null and m3OperateStatus!=''">`m3OperateStatus`,</if>
            <if test="m4ApproveId != null and m4ApproveId!=''">`m4_approve_id`,</if>
            <if test="m4OperateStatus != null and m4OperateStatus!=''">`m4OperateStatus`,</if>
            <if test="m5ApproveId != null and m5ApproveId!=''">`m5_approve_id`,</if>
            <if test="m5OperateStatus != null and m5OperateStatus!=''">`m5OperateStatus`,</if>
            <if test="m6ApproveId != null and m6ApproveId!=''">`m6_approve_id`,</if>
            <if test="status != null and status!=''">`status`,</if>
            <if test="promiseRepaymentTime != null">`promise_repayment_time`,</if>
            <if test="lastCollectionTime != null">`last_collection_time`,</if>
            <if test="createDate != null">`create_date`,</if>
            <if test="updateDate != null">`update_date`,</if>
            <if test="operatorName != null and operatorName!=''">`operator_name`,</if>
            <if test="remark != null and remark!=''">`remark`,</if>
            <if test="outsidePersonId != null and outsidePersonId!=''">`outside_person_id`,</if>
            <if test="beforeStatus != null and beforeStatus!=''">`before_status`,</if>
            <if test="outsideCompanyId != null and outsideCompanyId!=''">`outside_company_id`,</if>
            <if test="jxlStatus != null and jxlStatus!=''">`jxl_status`,</if>
            <if test="renewStatus != null and renewStatus!=''">`renew_status`,</if>
            <if test="jxlApplyTime != null">`jxl_apply_Time`,</if>
            <if test="jxAuditIme != null">`jx_audit_ime`,</if>
            <if test="csstatus != null and csstatus!=''">`csstatus`,</if>
            <if test="s1Flag!= null and s1Flag!=''">s1_flag,</if>
            <if test="loanUserName!= null and loanUserName!=''">loan_user_name,</if>
            <if test="loanUserPhone!= null and loanUserPhone!=''">loan_user_phone,</if>
            <if test="idNumber!= null and idNumber!=''">id_number,</if>
            <if test="secondDayFlag!= null and secondDayFlag!=''">second_day_flag,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null and id!=''">#{id,jdbcType=VARCHAR},</if>
            <if test="orderId != null and orderId!=''">#{orderId,jdbcType=VARCHAR},</if>
            <if test="userId != null and userId!=''">#{userId,jdbcType=VARCHAR},</if>
            <if test="loanId != null and loanId!=''">#{loanId,jdbcType=VARCHAR},</if>
            <if test="payId != null and payId!=''">#{payId,jdbcType=VARCHAR},</if>
            <if test="dispatchName != null and dispatchName!=''">#{dispatchName,jdbcType=VARCHAR},</if>
            <if test="dispatchTime != null">#{dispatchTime,jdbcType=TIMESTAMP},</if>
            <if test="lastCollectionUserId != null and lastCollectionUserId!=''">#{lastCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentCollectionUserId != null and currentCollectionUserId!=''">#{currentCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentOverdueLevel != null and currentOverdueLevel!=''">#{currentOverdueLevel,jdbcType=VARCHAR},</if>
            <if test="overdueDays != null">#{overdueDays,jdbcType=INTEGER},</if>
            <if test="m1ApproveId != null and m1ApproveId!=''">#{m1ApproveId,jdbcType=VARCHAR},</if>
            <if test="m1OperateStatus != null and m1OperateStatus!=''">#{m1OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m2ApproveId != null and m2ApproveId!=''">#{m2ApproveId,jdbcType=VARCHAR},</if>
            <if test="m2OperateStatus != null and m2OperateStatus!=''">#{m2OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m3ApproveId != null and m3ApproveId!=''">#{m3ApproveId,jdbcType=VARCHAR},</if>
            <if test="m3OperateStatus != null and m3OperateStatus!=''">#{m3OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m4ApproveId != null and m4ApproveId!=''">#{m4ApproveId,jdbcType=VARCHAR},</if>
            <if test="m4OperateStatus != null and m4OperateStatus!=''">#{m4OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m5ApproveId != null and m5ApproveId!=''">#{m5ApproveId,jdbcType=VARCHAR},</if>
            <if test="m5OperateStatus != null and m5OperateStatus!=''">#{m5OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m6ApproveId != null and m6ApproveId!=''">#{m6ApproveId,jdbcType=VARCHAR},</if>
            <if test="status != null and status!=''">#{status,jdbcType=VARCHAR},</if>
            <if test="promiseRepaymentTime != null">#{promiseRepaymentTime,jdbcType=TIMESTAMP},</if>
            <if test="lastCollectionTime != null">#{lastCollectionTime,jdbcType=TIMESTAMP},</if>
            <if test="createDate != null">#{createDate,jdbcType=TIMESTAMP},</if>
            <if test="updateDate != null">#{updateDate,jdbcType=TIMESTAMP},</if>
            <if test="operatorName != null and operatorName!=''">#{operatorName,jdbcType=VARCHAR},</if>
            <if test="remark != null and remark!=''">#{remark,jdbcType=VARCHAR},</if>
            <if test="outsidePersonId != null and outsidePersonId!=''">#{outsidePersonId,jdbcType=VARCHAR},</if>
            <if test="beforeStatus != null and beforeStatus!=''">#{beforeStatus,jdbcType=VARCHAR},</if>
            <if test="outsideCompanyId != null and outsideCompanyId!=''">#{outsideCompanyId,jdbcType=VARCHAR},</if>
            <if test="jxlStatus != null and jxlStatus!=''">#{jxlStatus,jdbcType=VARCHAR},</if>
            <if test="renewStatus != null">#{renewStatus,jdbcType=VARCHAR},</if>
            <if test="jxlApplyTime != null">#{jxlApplyTime,jdbcType=TIMESTAMP},</if>
            <if test="jxAuditIme != null">#{jxAuditIme,jdbcType=TIMESTAMP},</if>
            <if test="csstatus != null and csstatus!=''">#{csstatus,jdbcType=VARCHAR},</if>
            <if test="s1Flag!= null and s1Flag!=''">#{s1Flag},</if>
            <if test="loanUserName!= null and loanUserName!=''">#{loanUserName},</if>
            <if test="loanUserPhone!= null and loanUserPhone!=''">#{loanUserPhone},</if>
            <if test="idNumber!= null and idNumber!=''">#{idNumber},</if>
            <if test="secondDayFlag!= null and secondDayFlag!=''">#{secondDayFlag},</if>
        </trim>
    </insert>

    <!-- 更新不为NULL的字段 -->
    <update id="updateCollectionOrder" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">UPDATE mman_loan_collection_order
        <set>
            <if test="orderId != null">order_id=#{orderId,jdbcType=VARCHAR},</if>
            <if test="userId != null">user_id=#{userId,jdbcType=VARCHAR},</if>
            <if test="loanId != null">loan_id=#{loanId,jdbcType=VARCHAR},</if>
            <if test="payId != null">pay_id=#{payId,jdbcType=VARCHAR},</if>
            <if test="dispatchName != null">dispatch_name=#{dispatchName,jdbcType=VARCHAR},</if>
            <if test="dispatchTime != null">dispatch_time=#{dispatchTime,jdbcType=TIMESTAMP},</if>
            <if test="lastCollectionUserId != null">last_collection_user_id=#{lastCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentCollectionUserId != null">current_collection_user_id=#{currentCollectionUserId,jdbcType=VARCHAR},</if>
            <if test="currentOverdueLevel != null">current_overdue_level=#{currentOverdueLevel,jdbcType=VARCHAR},</if>
            <if test="overdueDays != null">overdueDays=#{overdueDays,jdbcType=INTEGER},</if>
            <if test="m1ApproveId != null">m1_approve_id=#{m1ApproveId,jdbcType=VARCHAR},</if>
            <if test="m1OperateStatus != null">m1OperateStatus=#{m1OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m2ApproveId != null and m2ApproveId!=''">m2_approve_id=#{m2ApproveId,jdbcType=VARCHAR},</if>
            <if test="m2OperateStatus != null and m2OperateStatus!=''">m2OperateStatus=#{m2OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m3ApproveId != null and m3ApproveId!=''">m3_approve_id=#{m3ApproveId,jdbcType=VARCHAR},</if>
            <if test="m3OperateStatus != null and m3OperateStatus!=''">m3OperateStatus=#{m3OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m4ApproveId != null and m4ApproveId!=''">m4_approve_id=#{m4ApproveId,jdbcType=VARCHAR},</if>
            <if test="m4OperateStatus != null and m4OperateStatus!=''">m4OperateStatus=#{m4OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m5ApproveId != null and m5ApproveId!=''">m5_approve_id=#{m5ApproveId,jdbcType=VARCHAR},</if>
            <if test="m5OperateStatus != null and m5OperateStatus!=''">m5OperateStatus=#{m5OperateStatus,jdbcType=VARCHAR},</if>
            <if test="m6ApproveId != null and m6ApproveId!=''">m6_approve_id=#{m6ApproveId,jdbcType=VARCHAR},</if>
            <if test="status != null and status!=''">status=#{status,jdbcType=VARCHAR},</if>
            promise_repayment_time=#{promiseRepaymentTime},
            <if test="lastCollectionTime != null">last_collection_time=#{lastCollectionTime,jdbcType=TIMESTAMP},</if>
            <if test="createDate != null">create_date=#{createDate,jdbcType=TIMESTAMP},</if>
            <if test="updateDate != null">update_date=#{updateDate,jdbcType=TIMESTAMP},</if>
            <if test="operatorName != null and operatorName!=''">operator_name=#{operatorName,jdbcType=VARCHAR},</if>
            <if test="remark != null and remark!=''">remark=#{remark,jdbcType=VARCHAR},</if>
            <if test="outsidePersonId != null and outsidePersonId!=''">outside_person_id=#{outsidePersonId,jdbcType=VARCHAR},</if>
            <if test="beforeStatus != null and beforeStatus!=''">before_status=#{beforeStatus,jdbcType=VARCHAR},</if>
            <if test="outsideCompanyId != null and outsideCompanyId!=''">outside_company_id=#{outsideCompanyId,jdbcType=VARCHAR},</if>
            <if test="jxlStatus != null and jxlStatus!=''">jxl_status=#{jxlStatus,jdbcType=VARCHAR},</if>
            <if test="renewStatus != null and renewStatus!=''">renew_status=#{renewStatus,jdbcType=VARCHAR},</if>
            <if test="jxlApplyTime != null">jxl_apply_Time=#{jxlApplyTime,jdbcType=TIMESTAMP},</if>
            <if test="jxAuditIme != null">jx_audit_ime=#{jxAuditIme,jdbcType=TIMESTAMP},</if>
            <if test="csstatus != null and csstatus!=''">csstatus=#{csstatus,jdbcType=VARCHAR},</if>
            s1_flag=#{s1Flag},
            <if test="loanUserName!= null and loanUserName!=''">loan_user_name=#{loanUserName},</if>
            <if test="loanUserPhone!= null and loanUserPhone!=''">loan_user_phone=#{loanUserPhone},</if>
            <if test="idNumber!= null and idNumber!=''">id_number=#{idNumber},</if>
        </set>
        WHERE id = #{id,jdbcType=VARCHAR}
    </update>
    <!-- 标记订单 -->
    <update id="updateTopOrder" parameterType="HashMap">
		UPDATE mman_loan_collection_order u SET u.`top_important`=#{topLevel} WHERE u.`id`=#{id} 
	</update>

    <update id="updateAuditStatus" parameterType="HashMap">
        UPDATE mman_loan_collection_order
        <set>
            <if test="csstatus != null and csstatus !=''">
                csstatus=#{csstatus,jdbcType=VARCHAR},
            </if>
            <if test="jxlStatus != null and jxlStatus !='' ">
                jxl_status=#{jxlStatus,jdbcType=VARCHAR},
            </if>
        </set>
        WHERE id = #{id,jdbcType=VARCHAR}
    </update>


    <!-- 根据条件查询符合的订单 -->
    <select id="getOrderList" resultMap="queryResultMap" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">
        SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id ,
        t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id
        , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date ,
        t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime ,
        t.csstatus,t.id_number FROM mman_loan_collection_order t WHERE 1=1
        <if test="orderId != null">and order_id=#{orderId,jdbcType=VARCHAR}</if>
        <if test="userId != null">and user_id=#{userId,jdbcType=VARCHAR}</if>
        <if test="loanId != null">and loan_id=#{loanId,jdbcType=VARCHAR}</if>
        <if test="payId != null">and pay_id=#{payId,jdbcType=VARCHAR}</if>
        <if test="dispatchName != null">and dispatch_name=#{dispatchName,jdbcType=VARCHAR}</if>
        <if test="dispatchTime != null">and dispatch_time=#{dispatchTime,jdbcType=TIMESTAMP}</if>
        <if test="lastCollectionUserId != null">and last_collection_user_id=#{lastCollectionUserId,jdbcType=VARCHAR}</if>
        <if test="currentCollectionUserId != null">and current_collection_user_id=#{currentCollectionUserId,jdbcType=VARCHAR}</if>
        <if test="currentOverdueLevel != null">and current_overdue_level=#{currentOverdueLevel,jdbcType=VARCHAR}</if>
        <if test="overdueDays != null">and overdueDays=#{overdueDays,jdbcType=INTEGER}</if>
        <if test="m1ApproveId != null">and m1_approve_id=#{m1ApproveId,jdbcType=VARCHAR}</if>
        <if test="m1OperateStatus != null">and m1OperateStatus=#{m1OperateStatus,jdbcType=VARCHAR}</if>
        <if test="m2ApproveId != null">and m2_approve_id=#{m2ApproveId,jdbcType=VARCHAR}</if>
        <if test="m2OperateStatus != null">and m2OperateStatus=#{m2OperateStatus,jdbcType=VARCHAR}</if>
        <if test="m3ApproveId != null">and m3_approve_id=#{m3ApproveId,jdbcType=VARCHAR}</if>
        <if test="m3OperateStatus != null">and m3OperateStatus=#{m3OperateStatus,jdbcType=VARCHAR}</if>
        <if test="m4ApproveId != null">and m4_approve_id=#{m4ApproveId,jdbcType=VARCHAR}</if>
        <if test="m4OperateStatus != null">and m4OperateStatus=#{m4OperateStatus,jdbcType=VARCHAR}</if>
        <if test="m5ApproveId != null">and m5_approve_id=#{m5ApproveId,jdbcType=VARCHAR}</if>
        <if test="m5OperateStatus != null">and m5OperateStatus=#{m5OperateStatus,jdbcType=VARCHAR}</if>
        <if test="m6ApproveId != null">and m6_approve_id=#{m6ApproveId,jdbcType=VARCHAR}</if>
        <if test="status != null">and status=#{status,jdbcType=VARCHAR}</if>
        <if test="promiseRepaymentTime != null">and promise_repayment_time=#{promiseRepaymentTime,jdbcType=TIMESTAMP}</if>
        <if test="lastCollectionTime != null">and last_collection_time=#{lastCollectionTime,jdbcType=TIMESTAMP}</if>
        <!-- <if test="createDate != null">create_date=#{createDate,jdbcType=TIMESTAMP},</if>
        <if test="updateDate != null">update_date=#{updateDate,jdbcType=TIMESTAMP},</if>   -->
        <if test="operatorName != null">and operator_name=#{operatorName,jdbcType=VARCHAR}</if>
        <if test="remark != null">and remark=#{remark,jdbcType=VARCHAR}</if>
        <if test="outsidePersonId != null">and outside_person_id=#{outsidePersonId,jdbcType=VARCHAR}</if>
        <if test="beforeStatus != null">and before_status=#{beforeStatus,jdbcType=VARCHAR}</if>
        <if test="outsideCompanyId != null">and outside_company_id=#{outsideCompanyId,jdbcType=VARCHAR}</if>
        <if test="jxlStatus != null">and jxl_status=#{jxlStatus,jdbcType=VARCHAR}</if>
        <if test="renewStatus != null">and renew_status=#{renewStatus,jdbcType=VARCHAR}</if>
        <if test="csstatus != null">and csstatus=#{csstatus,jdbcType=VARCHAR}</if>
    </select>

    <select id="getOrderPageCount" resultType="int" parameterType="HashMap">
		select count(1) from mman_loan_collection_order
	</select>

    <select id="getOrderPage" resultMap="queryResultMap" parameterType="HashMap">
		SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime , t.csstatus,t.id_number FROM mman_loan_collection_order t
		WHERE 1=1
	</select>

    <select id="getOrderWithId" parameterType="String" resultType="com.info.web.pojo.MmanLoanCollectionOrder">
		select id,order_id,overdueDays from mman_loan_collection_order where loan_id = #{orderId}
	</select>
    <!-- 减免状态更新 -->
    <update id="updateJmStatus" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">

        UPDATE mman_loan_collection_order

        <set>
            <if test="status != null">status=#{status}</if>

        </set>
        WHERE id = #{id}
    </update>
    <!--添加审核滞纳金-->
    <update id="updateReductionMoney" parameterType="HashMap">

        UPDATE mman_loan_collection_order a

        <set>
            <if test="reductionMoney != null">a.reduction_money = #{reductionMoney}</if>
        </set>
        WHERE id = #{orderId}
    </update>
    <!-- 审核减免状态更新 -->
    <update id="sveUpdateJmStatus" parameterType="HashMap">
        UPDATE mman_loan_collection_order
        <set>
            <if test="status != null and status !=''">
                status=#{status,jdbcType=VARCHAR},
            </if>
        </set>
        WHERE id = #{id,jdbcType=VARCHAR}
    </update>
    <!-- 减免定时修改订单金额 状态-->
    <update id="sveUpdateNotNull" parameterType="HashMap">
        UPDATE mman_loan_collection_order
        <set>
            <if test="status != null and status !=''">
                status=#{status},
            </if>
            <if test="reductionMoney != null and reductionMoney!='' ">
                reduction_money = #{reductionMoney}
            </if>
        </set>
        WHERE loan_id = #{loanId}
    </update>
    <!--成功订单审核判断-->
    <select id="getOrderloanId" parameterType="String" resultType="com.info.web.pojo.MmanLoanCollectionOrder">
		select `status` from mman_loan_collection_order where loan_id = #{loanId}
	</select>


    <!--审核后更新订单status-->
    <update id="updateReductionOrder" parameterType="HashMap">
        UPDATE mman_loan_collection_order
        <set>
            <if test="orderStatus != null and orderStatus !=''">
                status=#{orderStatus},
            </if>
            <if test="reductionMoney != null">
                reduction_money = #{reductionMoney}
            </if>
        </set>
        WHERE id = #{orderId}
    </update>


    <select id="getLatestLoanByUserPhoneAndLoanEndTime" parameterType="HashMap" resultType="String">
		select l.id from mman_loan_collection_order o LEFT JOIN mman_user_loan l on l.id = o.loan_id where loan_user_phone = #{userPhone} AND l.loan_end_time = #{loanEndTime}
	</select>
    <select id="getOrderByLoanId" parameterType="String" resultMap="queryResultMap">
		SELECT loan_id,id_number,status,user_id,loan_user_name,overdueDays,current_overdue_level FROM mman_loan_collection_order WHERE loan_id = #{loanId}
	</select>
    <select id="getStopOrderInfoById" parameterType="String" resultType="com.info.web.pojo.OrderInfo">
		SELECT o.loan_id AS loanId,o.loan_user_name AS loanUserName,l.user_id AS userId,o.order_id AS orderId,o.loan_user_phone AS loanUserPhone,l.loan_money AS
		loanMoney,l.loan_start_time AS loanStartTime,l.loan_end_time AS loanEndTime,o.overDuedays AS overDuedays,l.loan_penalty AS loanPenalty from mman_loan_collection_order o
		INNER JOIN mman_user_loan l on l.id = o.loan_id WHERE o.id = #{id}
	</select>
    <update id="deleteOrderInfoAndLoanInfoByloanId" parameterType="String">
		UPDATE mman_loan_collection_order o INNER JOIN mman_user_loan l on l.id = o.loan_id SET o.`status` = '-1',l.`loan_status` = '-1' WHERE o.loan_id = #{loanId}
	</update>

    <!-- 查询1号还款完成订单信息 -->
    <select id="getOrderInFirstDay" resultMap="queryResultMap" parameterType="HashMap">
		SELECT
			o.outside_company_id,o.current_collection_user_id,o.current_overdue_level,o.s1_flag,o.loan_id
		FROM
			mman_loan_collection_status_change_log lo INNER JOIN mman_loan_collection_order o ON o.order_id = lo.loan_collection_order_id
		WHERE
			DATE_FORMAT(lo.create_date, "%Y-%m-%d") = (SELECT DATE_ADD(curdate(),INTERVAL - DAY (curdate()) + 1 DAY))
			AND o.`status` = #{orderStatus}
			AND o.current_overdue_level &lt;= #{overDueLevel}
			AND lo.remark LIKE '%还款成功催收员%'
		GROUP BY
			lo.loan_collection_order_id
	</select>

    <!-- 更新订单信息到指定催收员 -->
    <update id="updateOrderInfo" parameterType="HashMap">
	UPDATE mman_loan_collection_order o
	INNER JOIN mman_loan_collection_status_change_log l ON o.order_id = l.loan_collection_order_id
	SET  l.company_id = #{companyId},
		 l.current_collection_user_id = #{currentCollectionUserId},
		 l.current_collection_user_level = #{collectionUserOverDueLevel},
		 l.current_collection_Order_Level = #{orderLevel},
		 l.remark = #{remark},
		 o.current_collection_user_id = #{orderCurrentCollectionUserId},
		 o.current_overdue_level = #{orderCollectionUserOverDueLevel},
		 o.outside_company_id = #{orderCompanyId}
	WHERE
		 o.loan_id = #{loanId}
	AND l.type = '5';
	</update>

    <update id="updateOrderOverdueDays" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">
		UPDATE mman_loan_collection_order SET overdueDays = #{overdueDays} WHERE loan_id = #{loanId}
	</update>

    <select id="getOverdueOrderIds" parameterType="Map" resultType="String">
        SELECT loan_id FROM mman_loan_collection_order
        <where>
            <if test="orderStatus != null and orderStatus != ''">
                AND `status` != #{orderStatus}
            </if>
        </where>
    </select>

	<update id="updateOverdueDays" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">
		UPDATE mman_loan_collection_order o
		SET o.overdueDays = #{overdueDays},
		    o.update_date=#{updateDate}
		WHERE o.loan_id = #{loanId}
	</update>

    <update id="updateProductName" parameterType="com.info.web.pojo.MmanLoanCollectionOrder">
        UPDATE mman_loan_collection_order o
        SET o.product_name = #{productName}
        WHERE o.loan_id = #{loanId}
    </update>



    <select id="selectOrderCount4SmallEstemate" parameterType="String" resultType="java.lang.Integer">
        <![CDATA[ SELECT count(*) FROM mman_loan_collection_order WHERE status<>4 and current_overdue_level=${groupLevel}]]>
    </select>
    <select id="selectOrderCount4BigEstemate" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        <![CDATA[ SELECT count(*) FROM mman_loan_collection_order mlco
            left join mman_user_loan mul ON mul.id = mlco.loan_id
            WHERE mlco.status<>4 and mul.borrowing_type=1 and mlco.overdueDays=${overdueDays}]]>
    </select>
</mapper>
